(function(){var e={52824:function(e,t,i){e.exports=i(76947)(1089)},31204:function(e,t,i){e.exports=i(76947)(1243)},52487:function(e,t,i){e.exports=i(76947)(2137)},24143:function(e,t,i){e.exports=i(76947)(2238)},53285:function(e,t,i){e.exports=i(76947)(3693)},20953:function(e,t,i){e.exports=i(76947)(6074)},16136:function(e,t,i){e.exports=i(76947)(6220)},76947:function(e){"use strict";e.exports=etsy_libs_917e650259b4f0dd4314}};var t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};e[n](s,s.exports,i);return s.exports}!function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};i.d(t,{a:t});return t}}();!function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:true,get:t[n]})}}();!function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}();!function(){"use strict";var e=i(20953);var t=i.n(e);var n=i(24143);var o=i(53285);var s=i(52824);var a=i(16136);var r=i(31204);function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){v(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function h(e,t,i){t&&c(e.prototype,t);i&&c(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}function v(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}var f={maxLoops:5,minBufferedPercentage:0,moduleName:"",enableSentryErrors:true};var p=5;var g="wt_video_base";var y={FINISHED_FIRST_PLAY:"".concat(g,".finished_first_video_play"),LOOP:"".concat(g,".loop"),FINISHED_AUTOPLAY:"".concat(g,".finished_autoplay"),PLAY:"".concat(g,".play"),PLAYING:"".concat(g,".playing"),PAUSE:"".concat(g,".pause"),STOP:"".concat(g,".stop"),CLICK:"".concat(g,".click"),STARTED_LOADING_VIDEO:"".concat(g,".started_loading_video"),LOADED_VIDEO:"".concat(g,".loaded_video"),ERROR:"".concat(g,".error")};var m={DEFAULT_OPTIONS:f,BUFFER_STALLED_LIMIT:p,EVENTS:y};var E=function(){function e(t,i){u(this,e);v(this,"options",void 0);v(this,"elements",void 0);v(this,"state","unloaded");v(this,"isEligibleToPlay",void 0);v(this,"clicked",void 0);v(this,"videoPlayCount",void 0);v(this,"totalVideoPlayCount",void 0);v(this,"lastBufferedTime",void 0);v(this,"bufferStalledCount",void 0);v(this,"playStartPromise",void 0);this.options=d(d({},m.DEFAULT_OPTIONS),i);this.bindToTargetedHTML(t);this.setState("unloaded");this.playStartPromise=null;this.isEligibleToPlay=true;this.clicked=false;this.videoPlayCount=0;this.totalVideoPlayCount=0;this.lastBufferedTime=0;this.bufferStalledCount=0;this.attachHandlers()}h(e,[{key:"play",value:function e(){var t=this;this.isEligibleToPlay=true;this.dispatchCustomEventWithData(m.EVENTS.PLAY);if(null!==this.playStartPromise)return this.playStartPromise;if(this.isPlaying())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase play(): video is not eligible to play");this.clicked=false;this.playStartPromise=this.loadVideo().then(this.checkVideoBuffer.bind(this)).then(this.playWithoutLoading.bind(this)).finally((function(){t.playStartPromise=null}));return this.playStartPromise}},{key:"stop",value:function e(){this.isEligibleToPlay=false;if(!this.isPlaying())return;this.elements.video.pause();this.setState("ready");this.dispatchCustomEventWithData(m.EVENTS.STOP,{videoPlayCount:this.videoPlayCount,clicked:this.clicked,duration:this.elements.video.currentTime});this.elements.video.currentTime=0;this.videoPlayCount=0}},{key:"pause",value:function e(){if(!this.isPlaying())return;this.dispatchCustomEventWithData(m.EVENTS.PAUSE,{videoPlayCount:this.videoPlayCount,clicked:this.clicked,duration:this.elements.video.currentTime});this.elements.video.pause();this.setState("ready")}},{key:"getCurrentState",value:function e(){return this.state}},{key:"isPlaying",value:function e(){return"playing"===this.state}},{key:"isLoading",value:function e(){return"loading"===this.state}},{key:"isReady",value:function e(){return"ready"===this.state}},{key:"setState",value:function e(t){this.state=t}},{key:"bindToTargetedHTML",value:function e(t){if(!(t instanceof HTMLVideoElement))throw new Error("WtVideoBase needs a video element to be passed in");var i=t.querySelectorAll("source");if(i.length<1)throw new Error("WtVideoBase needs at least one source");this.elements={video:t,sources:i}}},{key:"attachHandlers",value:function e(){var t=this;this.elements.video["controls"]&&this.attachListenersForUIControls();this.elements.sources.item(this.elements.sources.length-1).addEventListener("error",(function(e){t.onError(e||new Error("Error loading video source"))}));this.elements.video.addEventListener("ended",(function(){t.onVideoEnd()}));this.elements.video.addEventListener("click",(function(){t.clicked=true;t.dispatchCustomEventWithData(m.EVENTS.CLICK,{videoPlayCount:t.videoPlayCount,duration:t.elements.video.currentTime})}))}},{key:"attachListenersForUIControls",value:function e(){var t=this;this.elements.video.addEventListener("loadstart",(function(){t.setState("loading")}));this.elements.video.addEventListener("play",(function(){t.elements.video.readyState>t.elements.video.HAVE_CURRENT_DATA?t.setState("playing"):t.setState("loading")}));this.elements.video.addEventListener("playing",(function(){t.setState("playing")}));this.elements.video.addEventListener("loadeddata",(function(){t.setState("ready")}));this.elements.video.addEventListener("pause",(function(){if(t.elements.video.readyState>t.elements.video.HAVE_CURRENT_DATA)t.setState("ready");else{t.setState("unloaded");t.bufferStalledCount=0}}))}},{key:"loadVideo",value:function e(){var t=this;if(this.isLoading()||this.isReady()&&1!==this.elements.video.readyState)return Promise.resolve();return new Promise((function(e,i){t.setState("loading");t.elements.video.addEventListener("loadeddata",function t(){this.elements.video.removeEventListener("loaddeddata",t);e(void 0)}.bind(t));t.elements.video.addEventListener("error",(function(e){t.onError(e);i(e)}));t.elements.video.load();t.dispatchCustomEventWithData(m.EVENTS.STARTED_LOADING_VIDEO)}))}},{key:"checkVideoBuffer",value:function e(){var t=this;if(this.isReady())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase checkVideoBuffer(): video is not eligible to play");if(this.isBufferedEnough()){this.setState("ready");this.dispatchCustomEventWithData(m.EVENTS.LOADED_VIDEO);return Promise.resolve()}return new Promise((function(e){setTimeout((function(){e(void 0)}),250)})).then((function(){return t.checkVideoBuffer()}))}},{key:"playWithoutLoading",value:function e(){var t=this;if(this.isPlaying())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase playWithoutLoading(): video is not eligible to play");return(this.elements.video.play()||Promise.resolve()).then((function(){t.setState("playing");t.dispatchCustomEventWithData(m.EVENTS.PLAYING)})).catch((function(e){t.onError(e)}))}},{key:"onVideoEnd",value:function e(){var t=this;0===this.totalVideoPlayCount&&this.dispatchCustomEventWithData(m.EVENTS.FINISHED_FIRST_PLAY);this.videoPlayCount++;this.totalVideoPlayCount++;if(this.videoPlayCount<this.options.maxLoops){this.setState("ready");this.playWithoutLoading().then((function(){t.dispatchCustomEventWithData(m.EVENTS.LOOP,{videoPlayCount:t.videoPlayCount})})).catch((function(){t.stop()}))}else{this.stop();this.dispatchCustomEventWithData(m.EVENTS.FINISHED_AUTOPLAY)}}},{key:"isBufferedEnough",value:function e(){if(0===this.options.minBufferedPercentage)return true;var t=this.elements.video.buffered.length?this.elements.video.buffered.end(0):0;t===this.lastBufferedTime&&t!==this.elements.video.duration?this.bufferStalledCount++:this.lastBufferedTime=t;var i=t/this.elements.video.duration>=this.options.minBufferedPercentage;var n=this.bufferStalledCount>m.BUFFER_STALLED_LIMIT;return i||n}},{key:"onError",value:function e(t){this.setState("unloaded");this.bufferStalledCount=0;this.dispatchCustomEventWithData(m.EVENTS.ERROR,t);this.options.enableSentryErrors&&this.logSentryError(t)}},{key:"logSentryError",value:function e(t){s["default"].captureException(t||new Error("Error playing video"),{tags:{component:"WtVideoBase",module:this.options.moduleName}})}},{key:"dispatchCustomEventWithData",value:function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.elements.video.dispatchEvent(new CustomEvent(t,{detail:d({module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount},i)}))}}]);return e}();function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function P(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){L(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function T(e,t,i){t&&w(e.prototype,t);i&&w(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}function L(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}var O={SPINNER:".wt-video__spinner",SIGNAL:".wt-video__signal",PLAY:"button [data-wt-video-play-signal]",PAUSE:"button [data-wt-video-pause-signal]",VIDEO:".wt-video__element"};var _={maxLoops:5,minBufferedPercentage:0,moduleName:"",enableSentryErrors:true};var V="wt_video_preview";var C={LOADED_VIDEO:"".concat(V,".loaded_video")};var A={DEFAULT_OPTIONS:_,EVENTS:C,SELECTORS:O};var D=function(){function e(t,i){b(this,e);L(this,"options",void 0);L(this,"elements",void 0);L(this,"isPlayCloseButtonActive",void 0);L(this,"isPlaying",void 0);L(this,"totalVideoPlayCount",void 0);L(this,"totalVideoShownCount",void 0);L(this,"showSpinnerStartedTime",void 0);L(this,"showSpinnerAccumulatedTime",void 0);L(this,"videoBase",void 0);L(this,"disableOnHover",void 0);this.options=P(P({},A.DEFAULT_OPTIONS),i);this.bindToTargetedHTML(t);this.isPlaying=false;this.isPlayCloseButtonActive=false;this.disableOnHover=false;this.totalVideoPlayCount=0;this.totalVideoShownCount=0;this.showSpinnerStartedTime=0;this.showSpinnerAccumulatedTime=0;this.elements.playSignal?this.a11yShowVisualState(this.elements.playSignal):this.a11yShowVisualState(this.elements.signal);this.attachHandlers()}T(e,[{key:"play",value:function e(){var t=this;if(this.isPlayCloseButtonActive||this.disableOnHover)return Promise.resolve();this.isPlaying=true;return this.videoBase.play().catch((function(){t.updateVisualLoadingState();t.updateVisualPlayingState();return"video did not play because it was not eligible to play"}))}},{key:"stop",value:function e(){if(this.isPlayCloseButtonActive)return;this.isPlaying=false;this.videoBase.stop();this.updateVisualLoadingState();this.updateVisualPlayingState()}},{key:"pause",value:function e(){if(this.isPlayCloseButtonActive)return;this.isPlaying=false;this.videoBase.pause()}},{key:"bindToTargetedHTML",value:function e(t){var i=t.querySelector(A.SELECTORS.SPINNER);var n=t.querySelector(A.SELECTORS.SIGNAL);var o=t.querySelector(A.SELECTORS.PLAY);var s=t.querySelector(A.SELECTORS.PAUSE);var a=t.querySelector(A.SELECTORS.VIDEO);if(!(i instanceof HTMLElement))throw new Error("WtVideoPreview needs a spinner with the class .wt-video__spinner");if(!(n instanceof HTMLElement))throw new Error("WtVideoPreview needs a play signal with the class .wt-video__signal");if(!(a instanceof HTMLVideoElement))throw new Error("WtVideoPreview needs a video element as a child of the root element that was passed in");this.videoBase=new E(a,this.options);this.elements={root:t,video:a,spinner:i,signal:n,playSignal:null!==o&&void 0!==o?o:void 0,pauseSignal:null!==s&&void 0!==s?s:void 0}}},{key:"attachHandlers",value:function e(){var t=this;this.elements.video.addEventListener(m.EVENTS.STARTED_LOADING_VIDEO,(function(){t.updateVisualLoadingState();0===t.showSpinnerStartedTime&&(t.showSpinnerStartedTime=performance.now())}));this.elements.video.addEventListener(m.EVENTS.LOADED_VIDEO,(function(){var e,i;if(0!==t.showSpinnerStartedTime){t.showSpinnerAccumulatedTime+=performance.now()-t.showSpinnerStartedTime;t.showSpinnerStartedTime=0}t.updateVisualLoadingState();var n=0===t.totalVideoShownCount?{spinnerShownTime:t.showSpinnerAccumulatedTime}:{};t.dispatchCustomEventWithData(A.EVENTS.LOADED_VIDEO,n);t.totalVideoShownCount++;null===(e=(i=t.options).onVideoStateChange)||void 0===e?void 0:e.call(i,m.EVENTS.LOADED_VIDEO)}));this.elements.video.addEventListener(m.EVENTS.PLAYING,(function(){var e,i;t.updateVisualPlayingState();null===(e=(i=t.options).onVideoStateChange)||void 0===e?void 0:e.call(i,m.EVENTS.PLAYING)}));this.elements.video.addEventListener(m.EVENTS.PAUSE,(function(){var e,i;null===(e=(i=t.options).onVideoStateChange)||void 0===e?void 0:e.call(i,m.EVENTS.PAUSE)}));this.elements.video.addEventListener(m.EVENTS.STOP,(function(){var e,i;t.updateVisualLoadingState();t.updateVisualPlayingState();null===(e=(i=t.options).onVideoStateChange)||void 0===e?void 0:e.call(i,m.EVENTS.STOP)}));this.elements.video.addEventListener(m.EVENTS.ERROR,(function(){var e,i;t.updateVisualLoadingState();t.updateVisualPlayingState();null===(e=(i=t.options).onVideoStateChange)||void 0===e?void 0:e.call(i,m.EVENTS.ERROR)}));this.elements.signal instanceof HTMLButtonElement&&this.elements.signal.addEventListener("click",(function(e){t.isPlaying?t.pause():t.play();t.updateVisualPlayingState();e.stopPropagation()}))}},{key:"updateVisualPlayingState",value:function e(){if(this.elements.playSignal&&this.elements.pauseSignal)if(this.isPlaying){this.a11yHideVisualState(this.elements.playSignal);this.a11yShowVisualState(this.elements.pauseSignal);this.a11yShowVisualState(this.elements.video)}else{this.a11yShowVisualState(this.elements.playSignal);this.a11yHideVisualState(this.elements.pauseSignal);this.a11yHideVisualState(this.elements.video)}else if(this.isPlaying){this.a11yHideVisualState(this.elements.signal);this.a11yShowVisualState(this.elements.video)}else{this.a11yShowVisualState(this.elements.signal);this.a11yHideVisualState(this.elements.video)}}},{key:"updateVisualLoadingState",value:function e(){this.videoBase.isLoading()&&this.isPlaying?this.a11yShowVisualState(this.elements.spinner):this.a11yHideVisualState(this.elements.spinner)}},{key:"dispatchCustomEventWithData",value:function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.elements.video.dispatchEvent(new CustomEvent(t,{detail:P({module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount},i)}))}},{key:"a11yShowVisualState",value:function e(t){var i=t;if(i===this.elements.playSignal||i===this.elements.pauseSignal||i===this.elements.signal)i.classList.remove("wt-video__signal--hidden");else if(i===this.elements.video)i.classList.remove("wt-video__element--hidden");else if(i===this.elements.spinner){i.classList.add("wt-video__spinner--visible");i.classList.remove("wt-video__spinner--hidden")}i.setAttribute("aria-hidden","false")}},{key:"a11yHideVisualState",value:function e(t){var i=t;if(i===this.elements.playSignal||i===this.elements.pauseSignal||i===this.elements.signal)i.classList.add("wt-video__signal--hidden");else if(i===this.elements.video)i.classList.add("wt-video__element--hidden");else if(i===this.elements.spinner){i.classList.add("wt-video__spinner--hidden");i.classList.remove("wt-video__spinner--visible")}i.setAttribute("aria-hidden","true")}}]);return e}();var k=i(52487);function I(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function N(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?I(Object(i),!0).forEach((function(t){R(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):I(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function B(e,t,i){t&&H(e.prototype,t);i&&H(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}function R(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}var F=function(){function e(t,i,n){j(this,e);R(this,"options",void 0);R(this,"elements",void 0);R(this,"isTriggerHovered",void 0);R(this,"isTriggerFocused",void 0);R(this,"isActive",void 0);R(this,"videoPreview",void 0);this.options=N(N({},A.DEFAULT_OPTIONS),n);this.bindToTargetedHTML(t,i);this.isTriggerHovered=false;this.isTriggerFocused=false;this.isActive=this.isTriggerHovered||this.isTriggerFocused;k["default"].prefersReducedMotion()||this.attachHandlers()}B(e,[{key:"play",value:function e(){return this.videoPreview.play()}},{key:"stop",value:function e(){this.videoPreview.stop()}},{key:"bindToTargetedHTML",value:function e(t,i){this.videoPreview=new D(t,this.options);this.elements={root:t,activeTrigger:i}}},{key:"attachHandlers",value:function e(){var t=this;this.elements.activeTrigger.addEventListener("mouseenter",(function(){t.isTriggerHovered=true;t.updateActiveState()}));this.elements.activeTrigger.addEventListener("mouseleave",(function(){var e;if(null!==(e=t.elements.root.querySelector("button"))&&void 0!==e&&e.matches(":hover"))return;t.isTriggerHovered=false;t.updateActiveState()}));this.elements.activeTrigger.addEventListener("focus",(function(){t.isTriggerFocused=true;t.updateActiveState()}));this.elements.activeTrigger.addEventListener("blur",(function(){t.isTriggerFocused=false;t.updateActiveState()}))}},{key:"updateActiveState",value:function e(){var t=this.isTriggerHovered||this.isTriggerFocused;if(this.isActive!==t){this.isActive=t;this.isActive?this.videoPreview.play():this.videoPreview.stop()}}}]);return e}();function W(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function U(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?W(Object(i),!0).forEach((function(t){M(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):W(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function M(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function Y(e,t,i){t&&q(e.prototype,t);i&&q(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}var G=5;var z=.2;var K=250;var J={selector:"listing-card-video",numOfLoops:5,enoughBufferedPercentage:0,moduleName:""};var Q=function(){function e(t,i){x(this,e);this.options=i;this.videoEl=t;this.videoContainer=t.parentElement;this.mediaContainer=this.setUpMediaContainer(this.videoContainer.parentElement);this.spinner=this.videoContainer.previousElementSibling;this.signal=this.videoContainer.nextElementSibling;this.sources=this.videoEl.querySelectorAll("source");this.listingId=t.getAttribute("data-listing-id");this.isActive=false;this.isLoading=false;this.isReady=false;this.isPlaying=false;this.clicked=false;this.videoPlayCount=0;this.totalVideoPlayCount=0;this.totalVideoShownCount=0;this.lastBufferedTime=0;this.bufferStalledCount=0;this.showSpinnerStartedTime=0;this.showSpinnerAccumulatedTime=0;this.videoOptimizations=a["default"].getBoolean("is_eligible_for_video_optimizations",false);this.isEligibleForPrefetchLPWithSpeculationRules=a["default"].getBoolean("is_eligible_for_prefetch_lp_with_speculation_rules",false);this.activeVideoHover=false;this.initialSetup();this.attachHandlers()}Y(e,[{key:"setUpMediaContainer",value:function e(t){this.isEligibleForImageAndVideoCarousel=a["default"].getBoolean("is_eligible_for_image_and_video_carousel",false);if(this.isEligibleForImageAndVideoCarousel){var i=t.closest("div.main-carousel");if(!i)return t;this.oldMediaContainer=t;return t.closest("div.main-carousel")}return t}},{key:"initialSetup",value:function e(){var t=this;this.videoEl.removeAttribute(this.options.selector);r["default"].wtAccessibleShow(this.signal);this.sources[this.sources.length-1].addEventListener("error",(function(e){t.onError(e||new Error("Error loading video source"))}));this.mediaContainer.setAttribute("tabindex","0");this.videoEl.addEventListener("ended",(function(){t.onVideoEnd()}))}},{key:"onVideoEnd",value:function e(){this.isPlaying=false;0===this.totalVideoPlayCount&&this.logEventPipe("finished_first_video_play");this.videoPlayCount++;this.totalVideoPlayCount++;if(this.videoPlayCount<this.options.numOfLoops){this._play();this.statsD("loop");this.logEventPipe("loop",{videoPlayCount:this.videoPlayCount,listingId:this.listingId})}else{this.statsD("finished_autoplay");this.logEventPipe("finished_autoplay");this.videoPlayCount=0}}},{key:"attachHandlers",value:function e(){var t=this;var i=function e(){t.clicked=false;t.isActive=true;t.maybeInsertVideoHoverDiv();t.play();t.statsD("play");t.logEventPipe("play",{listingId:t.listingId})};this.mediaContainer.addEventListener("mouseenter",i);this.mediaContainer.addEventListener("focus",i);var n=function e(i){if(i.relatedTarget&&"favorite-listing-button"===i.relatedTarget.getAttribute("data-ui"))return;t.isActive=false;t.isEligibleForPrefetchLPWithSpeculationRules&&(t.activeVideoHover=false);t.updateLoadingState();t.updatePlayingState();var n=t.videoEl.currentTime;t.stop();t.statsD("stop");t.logEventPipe("stop",{videoPlayCount:t.videoPlayCount,clicked:t.clicked,duration:n})};this.mediaContainer.addEventListener("mouseleave",n);this.mediaContainer.addEventListener("blur",n);var o=function e(){t.clicked=true;t.statsD("click");t.logEventPipe("click",{videoPlayCount:t.videoPlayCount,duration:t.videoEl.currentTime})};this.isEligibleForImageAndVideoCarousel?this.oldMediaContainer.addEventListener("click",o):this.mediaContainer.addEventListener("click",o);this.mediaContainer.addEventListener("keydown",(function(e){if(!!e.code&&("Enter"===e.code||"Space"===e.code)){var t;o();null===(t=e.target.closest("a"))||void 0===t?void 0:t.dispatchEvent(new MouseEvent("click"))}}))}},{key:"play",value:function e(){var t=this;if(this.isPlaying||!this.isActive)return;if(this.isReady||this.isLoading)if(this.isLoading)if(this.isBufferedEnough()){this.isReady=true;this.isLoading=false;if(0!==this.showSpinnerStartedTime){this.showSpinnerAccumulatedTime+=performance.now()-this.showSpinnerStartedTime;this.showSpinnerStartedTime=0}this.updateLoadingState();this.statsD("loaded_video");var i={};if(0===this.totalVideoShownCount){this.statsDTiming("spinner_shown_time",this.showSpinnerAccumulatedTime);i={spinnerShownTime:this.showSpinnerAccumulatedTime}}this.logEventPipe("loaded_video",i);this.totalVideoShownCount++;this._play()}else setTimeout((function(){t.play()}),25);else 1===this.videoEl.readyState?this.videoEl.load():this._play();else{this.isLoading=true;this.updateLoadingState();this.videoEl.addEventListener("loadeddata",(function(){t.play()}));this.videoEl.addEventListener("error",(function(e){t.onError(e)}));0===this.showSpinnerStartedTime&&(this.showSpinnerStartedTime=performance.now());this.videoEl.load();this.statsD("started_loading_video")}}},{key:"_play",value:function e(){var t=this;if(this.isPlaying)return;(this.videoEl.play()||Promise.resolve()).then((function(){t.isPlaying=true;t.updatePlayingState()})).catch((function(e){return t.onError(e)}))}},{key:"stop",value:function e(){if(!this.isPlaying)return;this.videoEl.pause();this.videoOptimizations||(this.videoEl.currentTime=0);this.isPlaying=false;this.updatePlayingState();this.videoPlayCount=0}},{key:"isBufferedEnough",value:function e(){if(0===this.options.enoughBufferedPercentage)return true;var t=this.videoEl.buffered.length?this.videoEl.buffered.end(0):0;t===this.lastBufferedTime&&t!==this.videoEl.duration?this.bufferStalledCount++:this.lastBufferedTime=t;var i=t/this.videoEl.duration>=this.options.enoughBufferedPercentage;var n=this.bufferStalledCount>G;return i||n}},{key:"updateLoadingState",value:function e(){if(this.videoOptimizations)return;this.isLoading&&this.isActive?r["default"].wtAccessibleShow(this.spinner):r["default"].wtAccessibleHide(this.spinner)}},{key:"updatePlayingState",value:function e(){if(this.isPlaying&&this.isActive){r["default"].wtAccessibleHide(this.signal);this.videoOptimizations?this.showFadeInAnimation(this.videoContainer):r["default"].wtAccessibleShow(this.videoContainer)}else{r["default"].wtAccessibleShow(this.signal);this.videoOptimizations?this.hideFadeInAnimation(this.videoContainer):r["default"].wtAccessibleHide(this.videoContainer)}}},{key:"onError",value:function e(t){this.isLoading=false;this.isPlaying=false;this.updateLoadingState();this.updatePlayingState();if("NotAllowedError"===t.name){this.statsD("not_allowed");return}this.logSentryError(t);this.statsD("error")}},{key:"statsD",value:function e(t){o["default"].increment("lc_video.".concat(this.options.moduleName,".").concat(t.toLowerCase()),z)}},{key:"statsDTiming",value:function e(t,i){o["default"].timing("lc_video.".concat(this.options.moduleName,".").concat(t.toLowerCase()),i,z)}},{key:"logSentryError",value:function e(t){s["default"].captureException(t||new Error("Error playing listing card video"),{tags:{component:"listing-card/video-player",module:this.options.moduleName}})}},{key:"logEventPipe",value:function e(t){var i;var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s=parseInt(null!==(i=o.listingId)&&void 0!==i?i:this.listingId,10);n["default"].logEvent(U(U({event_name:"lc_video_".concat(t),module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount},o),{},{listingId:s}))}},{key:"hideFadeInAnimation",value:function e(t){if(!t)return;t.classList.remove("wt-animated--appear-01");t.classList.add("wt-animated--disappear-01");t.setAttribute("aria-hidden","true")}},{key:"showFadeInAnimation",value:function e(t){if(!t)return;t.classList.remove("wt-animated--disappear-01");t.classList.add("wt-animated--appear-01");t.setAttribute("aria-hidden","false")}},{key:"maybeInsertVideoHoverDiv",value:function e(){if(this.videoContainer.querySelector(".hover-cover")||this.activeVideoHover||!this.isEligibleForPrefetchLPWithSpeculationRules)return;this.activeVideoHover=true;var t=document.createElement("div");t.className="hover-cover";this.videoContainer.appendChild(t);setTimeout((function(){t.remove()}),K)}}]);return e}();var X={selector:"listing-card-video",moduleSelectors:null,numOfLoops:5,enoughBufferedPercentage:0,pageName:"",logVideoPresenceOnce:true};var Z=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e);if(!i.pageName)throw new Error("Listing Card Video Orchestrator needs a page or module name for logging and reporting");this.loggedVideoPresence=false;this.options=U(U({},X),i);this.setUpVideos();t()(document.body).on("etsy.listing.loaded",this.setUpVideos.bind(this))}Y(e,[{key:"setUpVideos",value:function e(){this.options.moduleSelectors&&this.options.moduleSelectors.size>=1?this.setUpVideosForMultipleModules():this.setUpVideosForSingleModule()}},{key:"setUpVideosForSingleModule",value:function e(){var t=this;var i=document.querySelectorAll("[".concat(this.options.selector,"]"));if(i.length){this.loggedVideoPresence&&this.options.logVideoPresenceOnce||this.logThatVideosArePresent(this.options.pageName,true,i.length);Array.prototype.forEach.call(i,(function(e){"VIDEO"===e.tagName&&new Q(e,t.getVideoOptions(t.options.selector,t.options.numOfLoops,t.options.enoughBufferedPercentage,t.options.pageName))}))}}},{key:"setUpVideosForMultipleModules",value:function e(){var t=this;this.options.moduleSelectors.forEach((function(e,i){var n="[".concat(e,"] [").concat(t.options.selector,"]");var o=document.querySelectorAll(n);if(o.length){t.logThatVideosArePresent(i,false,o.length);Array.prototype.forEach.call(o,(function(e){"VIDEO"===e.tagName&&new Q(e,t.getVideoOptions(t.options.selector,t.options.numOfLoops,t.options.enoughBufferedPercentage,i))}))}var s="[".concat(e,"] .wt-video.wt-video--preview");var a=document.querySelectorAll(s);if(a.length){t.logThatVideosArePresent(i,false,o.length);Array.prototype.forEach.call(a,(function(e){var n=e.closest("a");var o=U(U({},J),{},{maxLoops:t.options.numOfLoops,minBufferedPercentage:t.options.enoughBufferedPercentage,moduleName:i});new F(e,n,o);t.attachVideoPreviewEventListeners(e,i)}))}}))}},{key:"attachVideoPreviewEventListeners",value:function e(t,i){var n=this;var a=t.querySelector(A.SELECTORS.VIDEO);var r=t.getAttribute("data-listing-id");a.addEventListener(m.EVENTS.CLICK,(function(e){n.statsD("click_ds",i);n.logEventPipeWithListingId("click",r,e.detail)}));a.addEventListener(m.EVENTS.STOP,(function(e){n.statsD("stop_ds",i);n.logEventPipeWithListingId("stop",r,e.detail)}));a.addEventListener(m.EVENTS.STARTED_LOADING_VIDEO,(function(e){n.statsD("started_loading_video_ds",i)}));a.addEventListener(A.EVENTS.LOADED_VIDEO,(function(e){n.statsD("loaded_video_ds",i);n.logEventPipeWithListingId("loaded_video",r,e.detail);o["default"].timing("lc_video.".concat(i,".spinner_shown_time_ds"),e.detail.spinnerShownTime)}));a.addEventListener(m.EVENTS.PLAY,(function(e){n.statsD("play_ds",i);n.logEventPipeWithListingId("play",r,e.detail)}));a.addEventListener(m.EVENTS.PLAYING,(function(e){n.statsD("playing_ds",i);n.logEventPipeWithListingId("playing",r,e.detail)}));a.addEventListener(m.EVENTS.FINISHED_FIRST_PLAY,(function(e){n.logEventPipeWithListingId("finished_first_video_play",r,e.detail)}));a.addEventListener(m.EVENTS.LOOP,(function(e){n.statsD("loop_ds",i);n.logEventPipeWithListingId("loop",r,e.detail)}));a.addEventListener(m.EVENTS.FINISHED_AUTOPLAY,(function(e){n.statsD("finished_autoplay_ds");n.logEventPipeWithListingId("finished_autoplay",r,e.detail)}));a.addEventListener(m.EVENTS.ERROR,(function(e){if("NotAllowedError"===e.name){n.statsD("not_allowed_ds",i);return}n.statsD("error_ds",i);s["default"].captureException(e||new Error("Error playing listing card video"),{tags:{component:"listing-card/video-player",module:n.options.moduleName}})}))}},{key:"statsD",value:function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n=null!==i&&void 0!==i?i:this.options.moduleName;o["default"].increment("lc_video.".concat(n,".").concat(t.toLowerCase()),z)}},{key:"logEventPipeWithListingId",value:function e(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n["default"].logEvent(U({event_name:"lc_video_".concat(t),listingId:parseInt(i,10)},o))}},{key:"getVideoOptions",value:function e(t,i,n,o){return U(U({},J),{},{selector:t,numOfLoops:i,enoughBufferedPercentage:n,moduleName:o})}},{key:"logThatVideosArePresent",value:function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.loggedVideoPresence=i;n["default"].logEvent({event_name:"lc_video_present",module:t,num_videos:o})}}]);return e}();function $(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;"value"in n&&(n.writable=true);Object.defineProperty(e,n.key,n)}}function te(e,t,i){t&&ee(e.prototype,t);i&&ee(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}var ie=function(){function e(){$(this,e)}te(e,null,[{key:"log",value:function t(){var i=e.getUniqueVideos();if(i.length>0){var o={sm:0,md:0,lg:0};i.forEach((function(e){var t=e.closest(".v2-listing-card");if(t){var i=t.classList;i.contains("wt-grid__item-xl-3")?o.sm++:i.contains("wt-grid__item-xl-4")?o.md++:i.contains("wt-grid__item-xl-6")&&o.lg++}}));n["default"].logEvent({event_name:"shop_home_featured_listing_videos_loaded",num_videos:i.length,num_sm_videos:o.sm,num_md_videos:o.md,num_lg_videos:o.lg})}}},{key:"getUniqueVideos",value:function e(){var t=document.querySelectorAll(".featured-products-area:not(.wt-display-none) video");var i={};Array.from(t).forEach((function(e){var t=e.getAttribute("data-listing-id");t&&(i[t]=e)}));return Object.values(i)}}]);return e}();new Z({pageName:"shop_home",logVideoPresenceOnce:false});ie.log();t()(document.body).on("etsy.listing.loaded",ie.log)}()})();
//# sourceMappingURL=https://www.etsy.com/sourcemaps/primaryVendor/en-US/shop2/home-listing-card-videos.c4611fe5812eed5f8188.js.map